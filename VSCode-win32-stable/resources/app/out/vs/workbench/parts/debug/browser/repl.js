/*!--------------------------------------------------------
 * Copyright (C) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------*/
(function(){var e=["require","exports","vs/workbench/parts/debug/common/debugModel","vs/workbench/parts/debug/electron-browser/debugActions","vs/nls!vs/workbench/parts/debug/browser/repl","vs/workbench/parts/debug/common/replHistory","vs/css!vs/workbench/parts/debug/browser/media/repl","vs/nls!vs/workbench/parts/debug/browser/replViewer","vs/workbench/parts/debug/browser/replViewer","vs/base/common/errors","vs/base/browser/dom","vs/base/common/platform","vs/base/common/lifecycle","vs/base/common/uri","vs/base/common/strings","vs/base/common/winjs.base","vs/base/common/severity","vs/base/browser/mouseEvent","vs/css!vs/workbench/parts/debug/browser/repl","vs/workbench/parts/debug/browser/debugViewer","vs/nls","vs/workbench/services/editor/common/editorService","vs/platform/workspace/common/workspace","vs/workbench/parts/debug/browser/repl","vs/base/browser/ui/actionbar/actionbar","vs/base/parts/tree/browser/treeImpl","vs/platform/event/common/event","vs/workbench/common/events","vs/workbench/parts/debug/common/debug","vs/workbench/browser/panel","vs/platform/telemetry/common/telemetry","vs/platform/contextview/browser/contextView","vs/platform/instantiation/common/instantiation","vs/workbench/services/workspace/common/contextService","vs/platform/storage/common/storage","vs/base/common/keyCodes"],t=function(t){for(var n=[],r=0,i=t.length;r<i;r++)n[r]=e[t[r]];return n};define(e[6],t([18]),{}),define(e[7],t([20,4]),function(e,t){return e.create("vs/workbench/parts/debug/browser/replViewer",t)}),define(e[5],t([0,1]),function(e,t){"use strict";var n=50,r=function(){function e(e){this.history=e,this.historyPointer=this.history.length,this.currentExpressionStoredMarkers=!1,this.historyOverwrites={}}return e.prototype.next=function(){return this.navigate(!1)},e.prototype.previous=function(){return this.navigate(!0)},e.prototype.navigate=function(e){var t=-1;return e&&this.historyPointer>0&&this.history.length>this.historyPointer-1?t=this.historyPointer-1:!e&&this.history.length>this.historyPointer+1&&(t=this.historyPointer+1),t>=0?(this.historyPointer=t,this.historyOverwrites&&this.historyOverwrites[t.toString()]?this.historyOverwrites[t.toString()]:this.history[t]):null},e.prototype.remember=function(e,t){var n;n=t?this.historyPointer+1:this.historyPointer-1,n!==this.history.length||this.currentExpressionStoredMarkers?(this.historyOverwrites||(this.historyOverwrites={}),this.historyOverwrites[n.toString()]=e):(this.history.push(e),this.currentExpressionStoredMarkers=!0)},e.prototype.evaluated=function(e){this.currentExpressionStoredMarkers&&this.history.pop(),!e||0!==this.history.length&&this.history[this.history.length-1]===e||this.history.push(e),this.historyPointer=this.history.length,this.currentExpressionStoredMarkers=!1,this.historyOverwrites=null},e.prototype.save=function(){return this.currentExpressionStoredMarkers&&this.history.pop(),this.history.length>n&&(this.history=this.history.splice(this.history.length-n,n)),this.history},e}();t.ReplHistory=r});var n=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},i=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};define(e[8],t([0,1,7,15,14,13,11,24,10,9,16,17,2,19,3,21,22]),function(e,t,o,s,a,c,u,p,l,h,d,v,f,y,m,g,E){"use strict";function b(){return u.isMacintosh?".expression.mac":".expression.win-linux"}var S=l.emmet,T=function(){function e(e){this.debugService=e}return e.prototype.getId=function(e,t){return t.getId()},e.prototype.hasChildren=function(e,t){return t instanceof f.Model||t.reference>0||t instanceof f.KeyValueOutputElement&&t.getChildren().length>0},e.prototype.getChildren=function(e,t){return t instanceof f.Model?s.TPromise.as(t.getReplElements()):t instanceof f.KeyValueOutputElement?s.TPromise.as(t.getChildren()):t instanceof f.ValueOutputElement?s.TPromise.as(null):t.getChildren(this.debugService)},e.prototype.getParent=function(e,t){return s.TPromise.as(null)},e}();t.ReplExpressionsDataSource=T;var A=function(){function e(e,t){this.editorService=e,this.contextService=t}return e.prototype.getHeight=function(e,t){return this.getHeightForString(t.value)+(t instanceof f.Expression?this.getHeightForString(t.name):0)},e.prototype.getHeightForString=function(e){if(!e||!e.length||!this.width||this.width<=0||!this.characterWidth||this.characterWidth<=0)return 18;for(var t=0,n=0;n<e.length;n++)t+=a.isFullWidthCharacter(e.charCodeAt(n))?2:1;return 18*Math.ceil(t*this.characterWidth/this.width)},e.prototype.setWidth=function(e,t){this.width=e,this.characterWidth=t},e.prototype.getTemplateId=function(t,n){return n instanceof f.Variable?e.VARIABLE_TEMPLATE_ID:n instanceof f.Expression?e.INPUT_OUTPUT_PAIR_TEMPLATE_ID:n instanceof f.ValueOutputElement?e.VALUE_OUTPUT_TEMPLATE_ID:n instanceof f.KeyValueOutputElement?e.KEY_VALUE_OUTPUT_TEMPLATE_ID:null},e.prototype.renderTemplate=function(t,n,r){if(n===e.VARIABLE_TEMPLATE_ID){var i=Object.create(null);return i.expression=l.append(r,S(b())),i.name=l.append(i.expression,S("span.name")),i.value=l.append(i.expression,S("span.value")),i}if(n===e.INPUT_OUTPUT_PAIR_TEMPLATE_ID){var i=Object.create(null);return l.addClass(r,"input-output-pair"),i.input=l.append(r,S(".input"+b())),i.output=l.append(r,S(".output"+b())),i.value=l.append(i.output,S("span.value")),i.annotation=l.append(i.output,S("span")),i}if(n===e.VALUE_OUTPUT_TEMPLATE_ID){var i=Object.create(null);l.addClass(r,"output");var o=l.append(r,S(".output"+b()));return i.container=r,i.counter=l.append(o,S("div.counter")),i.value=l.append(o,S("span.value")),i}if(n===e.KEY_VALUE_OUTPUT_TEMPLATE_ID){var i=Object.create(null);return l.addClass(r,"output"),i.container=r,i.expression=l.append(r,S(".output"+b())),i.key=l.append(i.expression,S("span.name")),i.value=l.append(i.expression,S("span.value")),i.annotation=l.append(i.expression,S("span")),i}},e.prototype.renderElement=function(t,n,r,i){r===e.VARIABLE_TEMPLATE_ID?y.renderVariable(t,n,i,!1):r===e.INPUT_OUTPUT_PAIR_TEMPLATE_ID?this.renderInputOutputPair(t,n,i):r===e.VALUE_OUTPUT_TEMPLATE_ID?this.renderOutputValue(n,i):r===e.KEY_VALUE_OUTPUT_TEMPLATE_ID&&this.renderOutputKeyValue(t,n,i)},e.prototype.renderInputOutputPair=function(e,t,n){n.input.textContent=t.name,y.renderExpressionValue(t,n.value,!1),t.reference>0&&(n.annotation.className="annotation octicon octicon-info",n.annotation.title=o.localize(0,null))},e.prototype.renderOutputValue=function(e,t){e.counter>1?(t.counter.textContent=String(e.counter),t.counter.className=e.severity===d["default"].Warning?"counter warn":e.severity===d["default"].Error?"counter error":"counter info"):(t.counter.textContent="",t.counter.className="counter"),l.clearNode(t.value);var n=this.handleANSIOutput(e.value);"string"==typeof n?t.value.textContent=n:t.value.appendChild(n),t.value.className=e.severity===d["default"].Warning?"warn":e.severity===d["default"].Error?"error":"info"},e.prototype.handleANSIOutput=function(e){for(var t,n,r="",i=0,o=e.length;i<o;i++)if(27===e.charCodeAt(i)){var s=i,a=++s<o?e.charAt(s):null;if(a&&"["===a){var c=null;if(a=++s<o?e.charAt(s):null,a&&a>="0"&&a<="9"&&(c=a,a=++s<o?e.charAt(s):null),a&&a>="0"&&a<="9"&&(c+=a,a=++s<o?e.charAt(s):null),null===c&&(c="0"),"m"===a){var u=parseInt(c,10),p=document.createElement("span");u>=30&&u<=37||u>=90&&u<=97?p.className="code"+u:1===u&&(p.className="code-bold"),t||(t=document.createElement("span")),r&&(this.insert(this.handleLinks(r),n||t),r=""),n=p,t.appendChild(p),i=s}}}else r+=e[i];if(r){var l=this.handleLinks(r);("string"!=typeof l||n)&&(t||(t=document.createElement("span")),this.insert(l,n||t))}return t||r},e.prototype.insert=function(e,t){"string"==typeof e?t.textContent=e:t.appendChild(e)},e.prototype.handleLinks=function(t){for(var n,r=this,i=function(e){e.lastIndex=0;var i=e.exec(t),s=null;try{s=i&&c["default"].file(i[1])}catch(a){}if(s){n=document.createElement("span");var p=t.substr(0,i.index);if(p){var l=document.createElement("span");l.textContent=p,n.appendChild(l)}var h=document.createElement("a");h.textContent=t.substr(i.index,i[0].length),h.title=u.isMacintosh?o.localize(1,null):o.localize(2,null),n.appendChild(h),h.onclick=function(e){return r.onLinkClick(new v.StandardMouseEvent(e),s,Number(i[3]),Number(i[4]))};var d=t.substr(i.index+i[0].length);if(d){var l=document.createElement("span");l.textContent=d,n.appendChild(l)}return"break"}},s=0,a=e.FILE_LOCATION_PATTERNS;s<a.length;s++){var p=a[s],l=i(p);if("break"===l)break}return n||t},e.prototype.onLinkClick=function(e,t,n,r){var i=window.getSelection();"Range"!==i.type&&(e.preventDefault(),this.editorService.openEditor({resource:t,options:{selection:{startLineNumber:n,startColumn:r}}},e.ctrlKey||e.metaKey).done(null,h.onUnexpectedError))},e.prototype.renderOutputKeyValue=function(e,t,n){t.key?n.key.textContent=t.key+":":n.key.textContent="",y.renderExpressionValue(t.value,n.value,!1),t.annotation?(n.annotation.className="annotation octicon octicon-info",n.annotation.title=t.annotation):(n.annotation.className="",n.annotation.title="")},e.prototype.disposeTemplate=function(e,t,n){},e.VARIABLE_TEMPLATE_ID="variable",e.INPUT_OUTPUT_PAIR_TEMPLATE_ID="inputOutputPair",e.VALUE_OUTPUT_TEMPLATE_ID="outputValue",e.KEY_VALUE_OUTPUT_TEMPLATE_ID="outputKeyValue",e.FILE_LOCATION_PATTERNS=[/((\/|[a-zA-Z]:\\)[^\(\)<>\'\"\[\]]+):(\d+):(\d+)/],e=r([i(0,g.IWorkbenchEditorService),i(1,E.IWorkspaceContextService)],e)}();t.ReplExpressionsRenderer=A;var I=function(){function e(){}return e.prototype.getAriaLabel=function(e,t){return t instanceof f.Variable?o.localize(3,null,t.name,t.value):t instanceof f.Expression?o.localize(4,null,t.name,t.value):t instanceof f.ValueOutputElement?o.localize(5,null,t.value):t instanceof f.KeyValueOutputElement?o.localize(6,null,t.key,t.value):null},e}();t.ReplExpressionsAccessibilityProvider=I;var w=function(){function e(e){this.instantiationService=e}return e.prototype.hasActions=function(e,t){return!1},e.prototype.getActions=function(e,t){return s.TPromise.as([])},e.prototype.hasSecondaryActions=function(e,t){return!0},e.prototype.getSecondaryActions=function(e,t){var n=[];return(t instanceof f.Variable||t instanceof f.Expression)&&(n.push(this.instantiationService.createInstance(m.AddToWatchExpressionsAction,m.AddToWatchExpressionsAction.ID,m.AddToWatchExpressionsAction.LABEL,t)),n.push(new p.Separator)),n.push(new m.CopyAction(m.CopyAction.ID,m.CopyAction.LABEL)),n.push(this.instantiationService.createInstance(m.ClearReplAction,m.ClearReplAction.ID,m.ClearReplAction.LABEL)),s.TPromise.as(n)},e.prototype.getActionItem=function(e,t,n){return null},e}();t.ReplExpressionsActionProvider=w;var x=function(e){function t(t,n,r,i,o){void 0===o&&(o=!0),e.call(this,t,n,r,o),this.replInput=i,this.lastSelectedString=null}return n(t,e),t.prototype.onLeftClick=function(t,n,r,i){void 0===i&&(i="mouse");var o=r;(n.reference>0||n instanceof f.KeyValueOutputElement&&n.getChildren().length>0)&&o.target.className.indexOf("input expression")===-1&&(e.prototype.onLeftClick.call(this,t,n,r,i),t.clearFocus(),t.deselect(n));var s=window.getSelection();return"Range"===s.type&&this.lastSelectedString!==s.toString()||this.replInput.focus(),this.lastSelectedString=s.toString(),!0},t.prototype.onDown=function(t,n){if(t.getFocus())return e.prototype.onDown.call(this,t,n);var r={origin:"keyboard",originalEvent:n};return t.focusLast(r),t.reveal(t.getFocus()).done(null,h.onUnexpectedError),!0},t}(y.BaseDebugController);t.ReplExpressionsController=x}),define(e[23],t([0,1,4,9,12,10,11,25,26,27,8,28,2,3,5,29,30,31,32,33,34,35,6]),function(e,t,o,s,a,c,u,p,l,h,d,v,f,y,m,g,E,b,S,T,A,I){"use strict";var w=c.emmet,x={indentPixels:8,twistiePixels:20,paddingOnRow:!1,ariaLabel:o.localize(0,null)},P="debug.repl.history",_=function(e){function t(t,n,r,i,o,s,a,c){e.call(this,v.REPL_ID,i),this.debugService=t,this.contextMenuService=n,this.contextService=r,this.instantiationService=o,this.contextViewService=s,this.storageService=a,this.eventService=c,this.toDispose=[],this.registerListeners()}return n(t,e),t.prototype.registerListeners=function(){var e=this;this.toDispose.push(this.debugService.getModel().onDidChangeReplElements(function(){e.onReplElementsUpdated()})),this.toDispose.push(this.eventService.addListener2(h.EventType.COMPOSITE_OPENED,function(t){if(t.compositeId===v.REPL_ID){var n=e.debugService.getModel().getReplElements();if(n.length>0)return e.reveal(n[n.length-1])}}))},t.prototype.onReplElementsUpdated=function(){var e=this;if(this.tree){if(this.refreshTimeoutHandle)return;this.refreshTimeoutHandle=setTimeout(function(){e.refreshTimeoutHandle=null;var t=e.tree.getScrollPosition();e.tree.refresh().then(function(){0!==t&&1!==t||e.tree.setScrollPosition(1);var n=e.debugService.getModel().getReplElements(),r=n.length>0?n[n.length-1]:null;if(r instanceof f.Expression&&r.reference>0)return e.tree.expand(n[n.length-1]).then(function(){return e.tree.reveal(n[n.length-1],0)})},s.onUnexpectedError)},t.REFRESH_DELAY)}},t.prototype.create=function(n){var r=this;e.prototype.create.call(this,n);var i=c.append(n.getHTMLElement(),w(".repl"));this.treeContainer=c.append(i,w(".repl-tree"));var o=c.append(i,w(u.isWindows?".repl-input-wrapper.windows":u.isMacintosh?".repl-input-wrapper.mac":".repl-input-wrapper.linux"));this.replInput=c.append(o,w("input.repl-input")),this.replInput.type="text",this.toDispose.push(c.addStandardDisposableListener(this.replInput,"keydown",function(e){if(e.equals(I.CommonKeybindings.ENTER))r.debugService.addReplExpression(r.replInput.value),t.HISTORY.evaluated(r.replInput.value),r.replInput.value="",e.preventDefault();else if(e.equals(I.CommonKeybindings.UP_ARROW)||e.equals(I.CommonKeybindings.DOWN_ARROW)){var n=e.equals(I.CommonKeybindings.UP_ARROW)?t.HISTORY.previous():t.HISTORY.next();n&&(t.HISTORY.remember(r.replInput.value,e.equals(I.CommonKeybindings.UP_ARROW)),r.replInput.value=n,e.preventDefault())}})),this.toDispose.push(c.addStandardDisposableListener(this.replInput,c.EventType.FOCUS,function(){return c.addClass(o,"synthetic-focus")})),this.toDispose.push(c.addStandardDisposableListener(this.replInput,c.EventType.BLUR,function(){return c.removeClass(o,"synthetic-focus")})),this.characterWidthSurveyor=c.append(i,w(".surveyor")),this.characterWidthSurveyor.textContent=t.HALF_WIDTH_TYPICAL;for(var s=0;s<10;s++)this.characterWidthSurveyor.textContent+=this.characterWidthSurveyor.textContent;return this.characterWidthSurveyor.style.fontSize=u.isMacintosh?"12px":"14px",this.renderer=this.instantiationService.createInstance(d.ReplExpressionsRenderer),this.tree=new p.Tree(this.treeContainer,{dataSource:new d.ReplExpressionsDataSource(this.debugService),renderer:this.renderer,accessibilityProvider:new d.ReplExpressionsAccessibilityProvider,controller:new d.ReplExpressionsController(this.debugService,this.contextMenuService,new d.ReplExpressionsActionProvider(this.instantiationService),this.replInput,(!1))},x),t.HISTORY||(t.HISTORY=new m.ReplHistory(JSON.parse(this.storageService.get(P,A.StorageScope.WORKSPACE,"[]")))),this.tree.setInput(this.debugService.getModel())},t.prototype.layout=function(e){this.tree&&(this.renderer.setWidth(e.width-25,this.characterWidthSurveyor.clientWidth/this.characterWidthSurveyor.textContent.length),this.tree.layout(e.height-22),this.tree.refresh().done(void 0,s.onUnexpectedError))},t.prototype.focus=function(){this.replInput.focus()},t.prototype.reveal=function(e){return this.tree.reveal(e)},t.prototype.getActions=function(){var e=this;return this.actions||(this.actions=[this.instantiationService.createInstance(y.ClearReplAction,y.ClearReplAction.ID,y.ClearReplAction.LABEL)],this.actions.forEach(function(t){e.toDispose.push(t)})),this.actions},t.prototype.shutdown=function(){this.storageService.store(P,JSON.stringify(t.HISTORY.save()),A.StorageScope.WORKSPACE)},t.prototype.dispose=function(){this.toDispose=a.dispose(this.toDispose),e.prototype.dispose.call(this)},t.HALF_WIDTH_TYPICAL="n",t.REFRESH_DELAY=500,t=r([i(0,v.IDebugService),i(1,b.IContextMenuService),i(2,T.IWorkspaceContextService),i(3,E.ITelemetryService),i(4,S.IInstantiationService),i(5,b.IContextViewService),i(6,A.IStorageService),i(7,l.IEventService)],t)}(g.Panel);t.Repl=_})}).call(this);
//# sourceMappingURL=https://ticino.blob.core.windows.net/sourcemaps/e6b4afa53e9c0f54edef1673de9001e9f0f547ae/vs\workbench\parts\debug\browser\repl.js.map
