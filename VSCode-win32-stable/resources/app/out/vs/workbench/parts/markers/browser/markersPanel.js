/*!--------------------------------------------------------
 * Copyright (C) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------*/
(function(){var e=["vs/workbench/parts/markers/common/markersModel","require","exports","vs/base/common/winjs.base","vs/workbench/parts/markers/browser/markersActionProvider","vs/css!vs/workbench/parts/markers/browser/media/markers","vs/platform/instantiation/common/instantiation","vs/nls!vs/workbench/parts/markers/browser/markersActionProvider","vs/workbench/parts/markers/browser/markersTreeController","vs/base/common/errors","vs/workbench/services/editor/common/editorService","vs/platform/telemetry/common/telemetry","vs/workbench/parts/markers/browser/markersTreeViewer","vs/base/browser/dom","vs/workbench/parts/markers/common/messages","vs/nls","vs/nls!vs/workbench/parts/markers/browser/markersPanel","vs/platform/configuration/common/configuration","vs/base/common/actions","vs/css!vs/workbench/parts/markers/browser/markersPanel","vs/workbench/services/workspace/common/contextService","vs/base/browser/ui/countBadge/countBadge","vs/base/browser/ui/fileLabel/fileLabel","vs/base/browser/ui/highlightedlabel/highlightedLabel","vs/base/parts/tree/browser/treeDefaults","vs/workbench/parts/markers/browser/markersPanel","vs/base/common/set","vs/base/common/async","vs/base/common/lifecycle","vs/platform/markers/common/markers","vs/platform/event/common/event","vs/workbench/services/group/common/groupService","vs/workbench/parts/files/browser/editors/fileEditorInput","vs/workbench/browser/panel","vs/workbench/parts/markers/common/constants","vs/base/parts/tree/browser/treeImpl","vs/workbench/parts/markers/browser/markersPanelActions","vs/base/common/severity"],t=function(t){for(var r=[],o=0,n=t.length;o<n;o++)r[o]=e[t[o]];return r};define(e[5],t([19]),{}),define(e[7],t([15,16]),function(e,t){return e.create("vs/workbench/parts/markers/browser/markersActionProvider",t)});var r=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},n=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};define(e[4],t([1,2,7,3,18,6,0]),function(e,t,s,i,a,c,u){"use strict";var l=function(e){function t(){e.call(this,"remove",s.localize(0,null),"action-remove")}return r(t,e),t.prototype.run=function(e){return e.tree.refresh()},t}(a.Action),h=function(){function e(e){this.cache={},this.instantiationService=e}return e.prototype.getAction=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var o=this.cache[e.ID];return o||(t.unshift(e),o=this.cache[e.ID]=this.instantiationService.createInstance.apply(this.instantiationService,t)),o},e.prototype.dispose=function(){var e=this;Object.keys(this.cache).forEach(function(t){e.cache[t].dispose()}),this.cache=null},e}();t.ActionContainer=h;var p=function(e){function t(t){e.call(this,t)}return r(t,e),t.prototype.hasActions=function(e,t){return t instanceof u.Resource},t.prototype.getActions=function(e,t){return i.TPromise.as(this.getActionsForResource())},t.prototype.getActionsForResource=function(){return[new l]},t.prototype.hasSecondaryActions=function(e,t){return!1},t.prototype.getSecondaryActions=function(e,t){return i.TPromise.as([])},t.prototype.getActionItem=function(e,t,r){return null},t=o([n(0,c.IInstantiationService)],t)}(h);t.ActionProvider=p}),define(e[8],t([1,2,9,24,0,10,11]),function(e,t,s,i,a,c,u){"use strict";var l=function(e){function t(t,r){e.call(this),this.editorService=t,this.telemetryService=r}return r(t,e),t.prototype.onLeftClick=function(t,r,o){var n=t.getFocus();if(e.prototype.onLeftClick.call(this,t,r,o)){if(this.openFileAtElement(r,2!==o.detail,o.ctrlKey,2===o.detail))return!0;if(r instanceof a.MarkersModel)return n?t.setFocus(n):t.focusFirst(),!0}return!1},t.prototype.onEnter=function(t,r){return!!e.prototype.onEnter.call(this,t,r)&&this.openFileAtElement(t.getFocus(),!1,!1,!1)},t.prototype.openFileAtElement=function(e,t,r,o){if(e instanceof a.Marker){this.telemetryService.publicLog("problems.marker.opened",{source:e.source});var n=e.marker;return this.editorService.openEditor({resource:n.resource,options:{selection:{startLineNumber:n.startLineNumber,startColumn:n.startColumn,endLineNumber:n.endLineNumber,endColumn:n.endColumn},preserveFocus:t,pinned:o}},r).done(null,s.onUnexpectedError),!0}return!1},t=o([n(0,c.IWorkbenchEditorService),n(1,u.ITelemetryService)],t)}(i.DefaultController);t.Controller=l}),define(e[12],t([1,2,3,13,37,20,21,22,23,0,14]),function(e,t,r,s,i,a,c,u,l,h,p){"use strict";var d=function(){function e(){}return e.prototype.getId=function(e,t){return t instanceof h.MarkersModel?"root":t instanceof h.Resource?t.uri.toString():t instanceof h.Marker?t.id:""},e.prototype.hasChildren=function(e,t){return t instanceof h.MarkersModel||t instanceof h.Resource},e.prototype.getChildren=function(e,t){return t instanceof h.MarkersModel?r.TPromise.as(t.filteredResources):t instanceof h.Resource?r.TPromise.as(t.markers):null},e.prototype.getParent=function(e,t){return r.TPromise.as(null)},e}();t.DataSource=d;var m=function(){function e(e,t,r){this.actionRunner=e,this.actionProvider=t,this.contextService=r}return e.prototype.getHeight=function(e,t){return 22},e.prototype.getTemplateId=function(t,r){return r instanceof h.Resource?e.RESOURCE_TEMPLATE_ID:r instanceof h.Marker?e.MARKER_TEMPLATE_ID:""},e.prototype.renderTemplate=function(t,r,o){switch(s.addClass(o,"markers-panel-tree-entry"),r){case e.RESOURCE_TEMPLATE_ID:return this.renderResourceTemplate(o);case e.MARKER_TEMPLATE_ID:return this.renderMarkerTemplate(o)}},e.prototype.renderResourceTemplate=function(e){var t=Object.create(null),r=s.append(e,s.emmet(".resource-label-container"));t.file=new u.FileLabel(r,null,this.contextService);var o=s.append(e,s.emmet(".count-badge-wrapper"));return t.count=new c.CountBadge(o),t},e.prototype.renderMarkerTemplate=function(e){var t=Object.create(null);return t.icon=s.append(e,s.emmet(".marker-icon")),t.source=new l.HighlightedLabel(s.append(e,s.emmet(""))),t.description=new l.HighlightedLabel(s.append(e,s.emmet(".marker-description"))),t.lnCol=s.append(e,s.emmet("span.marker-line")),t},e.prototype.renderElement=function(t,r,o,n){switch(o){case e.RESOURCE_TEMPLATE_ID:return this.renderResourceElement(t,r,n);case e.MARKER_TEMPLATE_ID:return this.renderMarkerElement(t,r,n)}},e.prototype.renderResourceElement=function(e,t,r){r.file.setValue(t.uri,t.matches),r.count.setCount(t.markers.length)},e.prototype.renderMarkerElement=function(t,r,o){var n=r.marker;o.icon.className="icon "+e.iconClassNameFor(n),o.description.set(n.message,r.labelMatches),o.description.element.title=n.message,s.toggleClass(o.source.element,"marker-source",!!n.source),o.source.set(n.source,r.sourceMatches),o.lnCol.textContent=p["default"].MARKERS_PANEL_AT_LINE_COL_NUMBER(n.startLineNumber,n.startColumn)},e.iconClassNameFor=function(e){switch(e.severity){case i["default"].Ignore:return"info";case i["default"].Info:return"info";case i["default"].Warning:return"warning";case i["default"].Error:return"error"}return""},e.prototype.disposeTemplate=function(e,t,r){},e.RESOURCE_TEMPLATE_ID="resource-template",e.MARKER_TEMPLATE_ID="marker-template",e=o([n(2,a.IWorkspaceContextService)],e)}();t.Renderer=m;var f=function(){function e(){}return e.prototype.getAriaLabel=function(e,t){return t instanceof h.Resource?p["default"].PROBLEMS_TREE_ARIA_LABEL_RESOURCE(t.name,t.markers.length):t instanceof h.Marker?p["default"].PROBLEMS_TREE_ARIA_LABEL_MARKER(t.marker):null},e}();t.ProblemsTreeAccessibilityProvider=f}),define(e[25],t([1,2,9,26,3,27,13,28,29,11,30,31,32,33,10,34,0,8,35,12,6,4,36,17,14,5]),function(e,t,s,i,a,c,u,l,h,p,d,m,f,v,g,k,E,b,y,A,R,S,M,w,C){"use strict";var T=function(e){function t(t,r,o,n,s,a,u){e.call(this,k["default"].MARKERS_PANEL_ID,u),this.instantiationService=t,this.markerService=r,this.editorGroupService=o,this.editorService=n,this.eventService=s,this.configurationService=a,this.lastSelectedRelativeTop=0,this.currentActiveFile=null,this.toDispose=[],this.delayedRefresh=new c.Delayer(1e3),this.autoExpanded=new i.ArraySet}return r(t,e),t.prototype.create=function(t){e.prototype.create.call(this,t),this.markersModel=new E.MarkersModel,u.addClass(t.getHTMLElement(),"markers-panel");var r=this.configurationService.getConfiguration();this.onConfigurationsUpdated(r);var o=u.append(t.getHTMLElement(),u.emmet(".markers-panel-container"));return this.createMessageBox(o),this.createTree(o),this.createActions(),this.createListeners(),this.render(),a.TPromise.as(null)},t.prototype.getTitle=function(){var e=this.markerService.getStatistics();return this.markersModel.getTitle(e)},t.prototype.layout=function(e){this.tree.layout(e.height)},t.prototype.focus=function(){this.tree.isDOMFocused()||(this.markersModel.hasFilteredResources()?(this.tree.DOMFocus(),0===this.tree.getSelection().length&&this.tree.focusFirst(),this.autoReveal(!0)):this.messageBox.focus())},t.prototype.getActions=function(){return this.collapseAllAction.enabled=this.markersModel.hasFilteredResources(),this.actions},t.prototype.refreshPanel=function(e){var t=this;return void 0===e&&(e=!1),this.collapseAllAction.enabled=this.markersModel.hasFilteredResources(),this.refreshAutoExpanded(),e&&this.updateTitleArea(),u.toggleClass(this.treeContainer,"hidden",!this.markersModel.hasFilteredResources()),this.renderMessage(),this.markersModel.hasFilteredResources()?this.tree.refresh().then(function(){t.autoExpand()}):a.TPromise.as(null)},t.prototype.createMessageBox=function(e){this.messageBoxContainer=u.append(e,u.emmet(".message-box-container")),this.messageBox=u.append(this.messageBoxContainer,u.emmet("span")),this.messageBox.setAttribute("tabindex","0")},t.prototype.createTree=function(e){this.treeContainer=u.append(e,u.emmet(".tree-container"));var t=this.instantiationService.createInstance(S.ActionProvider),r=this.instantiationService.createInstance(A.Renderer,this.getActionRunner(),t),o=this.instantiationService.createInstance(b.Controller);this.tree=new y.Tree(this.treeContainer,{dataSource:new A.DataSource,renderer:r,controller:o,accessibilityProvider:new A.ProblemsTreeAccessibilityProvider},{indentPixels:0,twistiePixels:20,ariaLabel:C["default"].MARKERS_PANEL_ARIA_LABEL_PROBLEMS_TREE})},t.prototype.createActions=function(){var e=this;this.collapseAllAction=this.instantiationService.createInstance(M.CollapseAllAction,this.tree,!0),this.filterAction=new M.FilterAction(this),this.actions=[this.filterAction,this.collapseAllAction],this.actions.forEach(function(t){e.toDispose.push(t)})},t.prototype.createListeners=function(){var e=this;this.toDispose.push(this.configurationService.onDidUpdateConfiguration(function(t){return e.onConfigurationsUpdated(t.config)})),this.toDispose.push(this.markerService.onMarkerChanged(this.onMarkerChanged,this)),this.toDispose.push(this.editorGroupService.onEditorsChanged(this.onEditorsChanged,this)),this.toDispose.push(this.tree.addListener2("selection",function(){return e.onSelected()}))},t.prototype.onMarkerChanged=function(e){this.updateResources(e),this.refreshPanel(!0),this.autoReveal()},t.prototype.onEditorsChanged=function(){var e=this.editorService.getActiveEditorInput();this.currentActiveFile=e instanceof f.FileEditorInput?e.getResource():null,this.autoReveal()},t.prototype.onConfigurationsUpdated=function(e){this.hasToAutoReveal=e&&e.problems&&e.problems.autoReveal},t.prototype.onSelected=function(){var e=this.tree.getSelection();e&&e.length>0&&(this.lastSelectedRelativeTop=this.tree.getRelativeTop(e[0]))},t.prototype.updateResources=function(e){var t=this;e.forEach(function(e){var r=t.markerService.read({resource:e}).slice(0);t.markersModel.update(e,r),t.markersModel.hasResource(e)||t.autoExpanded.unset(e.toString())})},t.prototype.render=function(){var e=this.markerService.read().slice(0);this.markersModel.update(e),this.tree.setInput(this.markersModel).then(this.autoExpand.bind(this)),u.toggleClass(this.treeContainer,"hidden",!this.markersModel.hasFilteredResources()),this.renderMessage()},t.prototype.renderMessage=function(){var e=this.markersModel.getMessage();this.messageBox.textContent=e,u.toggleClass(this.messageBoxContainer,"hidden",this.markersModel.hasFilteredResources())},t.prototype.refreshAutoExpanded=function(){var e=this;this.markersModel.nonFilteredResources.forEach(function(t){e.tree.isExpanded(t)&&e.autoExpanded.unset(t.uri.toString())})},t.prototype.autoExpand=function(){var e=this;this.markersModel.filteredResources.forEach(function(t){e.autoExpanded.contains(t.uri.toString())||(e.tree.expand(t).done(null,s.onUnexpectedError),e.autoExpanded.set(t.uri.toString()))})},t.prototype.autoReveal=function(e){void 0===e&&(e=!1);var t=this.configurationService.getConfiguration();t&&t.problems&&t.problems.autoReveal&&this.revealProblemsForCurrentActiveEditor(e)},t.prototype.revealProblemsForCurrentActiveEditor=function(e){void 0===e&&(e=!1);var t=this.getResourceForCurrentActiveFile();t?this.tree.isExpanded(t)&&this.hasSelectedMarkerFor(t)?(this.tree.reveal(this.tree.getSelection()[0],this.lastSelectedRelativeTop),e&&this.tree.setFocus(this.tree.getSelection()[0])):(this.tree.reveal(t,0),e&&(this.tree.setFocus(t),this.tree.setSelection([t]))):e&&(this.tree.setSelection([]),this.tree.focusFirst())},t.prototype.getResourceForCurrentActiveFile=function(){var e=this;if(this.currentActiveFile){var t=this.markersModel.filteredResources.filter(function(t){return e.currentActiveFile.toString()===t.uri.toString()});return t.length>0?t[0]:null}return null},t.prototype.hasSelectedMarkerFor=function(e){var t=this.tree.getSelection();return!!(t&&t.length>0&&t[0]instanceof E.Marker&&e.uri.toString()===t[0].marker.resource.toString())},t.prototype.getActionItem=function(t){return t.id===M.FilterAction.ID?this.instantiationService.createInstance(M.FilterInputBoxActionItem,this,t):e.prototype.getActionItem.call(this,t)},t.prototype.dispose=function(){this.delayedRefresh.cancel(),this.toDispose=l.dispose(this.toDispose),this.tree.dispose(),this.markersModel.dispose(),e.prototype.dispose.call(this)},t=o([n(0,R.IInstantiationService),n(1,h.IMarkerService),n(2,m.IEditorGroupService),n(3,g.IWorkbenchEditorService),n(4,d.IEventService),n(5,w.IConfigurationService),n(6,p.ITelemetryService)],t)}(v.Panel);t.MarkersPanel=T})}).call(this);
//# sourceMappingURL=https://ticino.blob.core.windows.net/sourcemaps/e6b4afa53e9c0f54edef1673de9001e9f0f547ae/vs\workbench\parts\markers\browser\markersPanel.js.map
